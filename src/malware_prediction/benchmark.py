import socket
import time

HOSTNAME = socket.gethostname()
MESSAGE = """
            --- {hostname} ---
            
                {function}

                {row_num}     

            --- {run_time} S ---"""


class _timeit:
    def __init__(self, f, save_path: str, row_count: int = 0):
        self.f = f
        self.save_path = save_path
        self.row_count = row_count

    def __call__(self, *args):
        start_time = time.time()
        self.f()
        run_time = round(time.time() - start_time, 2)
        with open(self.save_path, "a") as eval_file:
            eval_file.writelines(f"{HOSTNAME}, {self.row_count}, {run_time}\n")
        print(MESSAGE.format(hostname=HOSTNAME, function=self.f.__name__, row_num=self.row_count, run_time=run_time))


def timeit(function=None, save_path: str = "", row_count: int = 0):
    if function:
        return _timeit(function)
    else:
        def wrapper(function):
            return _timeit(function, save_path=save_path, row_count=row_count)

        return wrapper
