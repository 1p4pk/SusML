import pandas as pd

base_path = "/Users/ramin/Developer/Python/SusML/data/results"
PIs = ["pi01", "pi02", "pi03",
       "pi04", "pi05", "pi06",
       "pi07", "pi08", "pi09",
       "pi10", "pi11", "pi12"]

LOSS_FUNCTIONS = ["bceloss", "mseloss"]

OPTIMIZERS = ["adagrad", "adam", "adamw", "asgd", "sgd"]


def append_run_times():
    cpu_paths = []
    f = open(f"/Users/ramin/Developer/Python/SusML/data/results/run_time/run_time.csv", "w")
    for optimizer in OPTIMIZERS:
        for loss_function in LOSS_FUNCTIONS:
            for pi in PIs:
                run_time_file = open(
                    f"{base_path}/{pi}.local/benchmark/run_time_model_{optimizer}_{loss_function}_743456.csv")
                f.write(run_time_file.read().strip() + f", {optimizer}, {loss_function}\n")
                run_time_file.close()
            cpu_paths.clear()
    f.close()


def append(metric, category, row_number):
    paths = []

    for optimizer in OPTIMIZERS:
        for loss_function in LOSS_FUNCTIONS:
            result_file = open(
                f"/Users/ramin/Developer/Python/SusML/data/results/{metric}/{metric}_{category}_{optimizer}_{loss_function}.csv",
                "w")
            for pi in PIs:
                pi_file = open(
                    f"{base_path}/{pi}.local/benchmark/{metric}_{category}_{optimizer}_{loss_function}_{row_number}.csv")
                result_file.write(pi_file.read())
                pi_file.close()
            paths.clear()
            result_file.close()


def append_submissions():
    for optimizer in OPTIMIZERS:
        for loss_function in LOSS_FUNCTIONS:
            path = f"{base_path}/submission/submission_{optimizer}_{loss_function}.csv"
            df_result = pd.DataFrame()
            for pi in PIs:
                pi_path = f"{base_path}/{pi}.local/submission_{optimizer}_{loss_function}.csv"
                df_result = df_result.append(pd.read_csv(pi_path), ignore_index=True)
            df_result.to_csv(path, index=False)


if __name__ == "__main__":
    append_run_times()
    print("finish run times")
    append("cpu_usage", "model", "743456")
    print("finish cpu usage")
    append("memory_usage", "model", "743456")
    print("finish memory usage")
    append_submissions()
    print("finish submissions")
