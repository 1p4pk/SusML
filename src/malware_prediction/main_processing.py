import os
import socket
from data_preparator import DataPreparator


def run():
    world_size = int(os.environ['OMPI_COMM_WORLD_SIZE'])
    world_rank = int(os.environ['OMPI_COMM_WORLD_RANK'])
    hostname = socket.gethostname()
    print(f"Running rank {world_rank} of {world_size} on {hostname}")
    df = DataPreparator().import_data(20000, offset=20000 * world_rank + 1)
    cols, _ = DataPreparator().encode_data(df)
    df.to_csv(f"./data/result_{world_rank}.csv", index=False)


if __name__ == '__main__':
    run()

