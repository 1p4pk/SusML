import os
import socket
import time
import sys

from data_preparator import DataPreparator


def run(num_row):
    world_size = int(os.environ['OMPI_COMM_WORLD_SIZE'])
    world_rank = int(os.environ['OMPI_COMM_WORLD_RANK'])
    hostname = socket.gethostname()
    print(f"Running rank {world_rank} of {world_size} on {hostname}")
    df = DataPreparator().import_data(num_row, offset=num_row * world_rank + 1)
    DataPreparator().encode_data(df)
    df.to_csv(f"./data/train_encoded.csv", index=False)


if __name__ == '__main__':
    num_row = int(sys.argv[1])
    hostname = socket.gethostname()
    start_time = time.time()
    run(num_row)
    run_time = (time.time() - start_time)
    print(f"--- {hostname} ---")
    print(f"--- {run_time} seconds ---")


